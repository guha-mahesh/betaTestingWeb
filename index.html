<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Engramme Assistant — Beta Evaluation Guide</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'text-heading': '#151211',
            'text-body': '#2c2827',
            'text-body-light': '#787270',
            'bg-cream': '#faf9f5',
            'bg-subtle': '#f4f3f3',
            'border-light': '#e9e8e7',
            'border-medium': '#8f8a88',
            'accent-gold': '#e8a41a',
            'primary': '#262626',
          },
          fontFamily: {
            sans: ['DM Sans', 'system-ui', '-apple-system', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <style>
    html { scroll-behavior: smooth; }
    body { font-family: 'DM Sans', system-ui, -apple-system, sans-serif; color: #2c2827; }
    .nav-link { transition: all 0.2s; }
    .nav-link:hover, .nav-link.active { color: #151211; border-left-color: #262626; }
    .step-card { transition: all 0.2s; }
    .step-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    .section-img { border-radius: 1rem; border: 1px solid #e9e8e7; cursor: zoom-in; transition: transform 0.2s, box-shadow 0.2s; }
    .section-img:hover { transform: scale(1.02); box-shadow: 0 8px 24px rgba(0,0,0,0.12); }
    .phone-img { max-width: 280px; border-radius: 2rem; border: 1px solid #e9e8e7; cursor: zoom-in; transition: transform 0.2s, box-shadow 0.2s; }
    .phone-img:hover { transform: scale(1.02); box-shadow: 0 8px 24px rgba(0,0,0,0.12); }
    .lightbox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 100; justify-content: center; align-items: center; cursor: zoom-out; backdrop-filter: blur(4px); }
    .lightbox.active { display: flex; }
    .lightbox img { max-width: 90vw; max-height: 90vh; border-radius: 1rem; box-shadow: 0 24px 58px rgba(0,0,0,0.25); }
    @media (max-width: 1024px) {
      .sidebar { display: none; }
      .main-content { margin-left: 0 !important; }
    }
    /* Accordion step cards */
    .step-card .accordion-toggle { cursor: pointer; display: flex; align-items: center; justify-content: space-between; user-select: none; }
    .step-card .accordion-toggle .chevron { width: 20px; height: 20px; transition: transform 0.25s ease; flex-shrink: 0; color: #787270; }
    .step-card.collapsed .accordion-toggle .chevron { transform: rotate(-90deg); }
    .step-card.collapsed .accordion-body { display: none; }
    /* Checkbox steps */
    .todo-step { display: flex; align-items: flex-start; gap: 10px; }
    .todo-step input[type="checkbox"] { accent-color: #262626; width: 18px; height: 18px; margin-top: 1px; flex-shrink: 0; cursor: pointer; border-radius: 4px; }
    .todo-step.checked > .todo-content { opacity: 0.45; text-decoration: line-through; text-decoration-color: #b0adab; }
    .todo-step.checked > .todo-content img { opacity: 0.5; }
    /* Progress bar */
    .progress-bar-container { background: #e9e8e7; border-radius: 999px; height: 6px; overflow: hidden; }
    .progress-bar-fill { background: #262626; height: 100%; border-radius: 999px; transition: width 0.4s ease; }
  </style>
</head>
<body class="bg-white">

  <!-- Top Bar -->
  <header class="fixed top-0 left-0 right-0 bg-white/90 backdrop-blur-md border-b border-border-light z-50">
    <div class="flex items-center h-[57px]">
      <!-- Logo area — matches sidebar width on desktop -->
      <div class="hidden lg:flex items-center gap-2.5 w-64 flex-shrink-0 border-r border-border-light px-6 h-full">
        <img src="favicon.png" alt="Engramme" class="w-6 h-6">
        <span class="text-lg font-bold text-text-heading tracking-tight">Engramme</span>
      </div>
      <!-- Mobile logo -->
      <div class="flex lg:hidden items-center gap-2.5 px-6">
        <img src="favicon.png" alt="Engramme" class="w-6 h-6">
        <span class="text-lg font-bold text-text-heading tracking-tight">Engramme</span>
      </div>
      <!-- Content area -->
      <div class="flex-1 px-6 flex items-center justify-between">
        <span class="text-sm text-text-body-light font-medium">Beta Evaluation Guide</span>
        <a href="https://app.engramme.com" data-cfg-href="appUrl" target="_blank" class="hidden sm:inline-flex items-center gap-2 bg-primary text-white px-5 py-2 rounded-xl text-sm font-medium hover:opacity-90 transition-opacity">
          Open App
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
        </a>
      </div>
    </div>
  </header>

  <!-- Sidebar Navigation -->
  <nav class="sidebar fixed top-[57px] left-0 bottom-0 w-64 bg-bg-cream border-r border-border-light overflow-y-auto py-8 px-4 z-40">
    <div class="space-y-1">
      <p class="text-xs font-semibold text-text-body-light uppercase tracking-wider px-3 mb-3">Getting Started</p>
      <a href="#welcome" class="nav-link block px-3 py-2 text-sm text-text-body-light border-l-2 border-transparent rounded-r-lg">Welcome</a>
      <a href="#signup" class="nav-link block px-3 py-2 text-sm text-text-body-light border-l-2 border-transparent rounded-r-lg">Sign Up & Integrate</a>
      <a href="#chrome" class="nav-link block px-3 py-2 text-sm text-text-body-light border-l-2 border-transparent rounded-r-lg">Chrome Extension</a>
      <a href="#ios" class="nav-link block px-3 py-2 text-sm text-text-body-light border-l-2 border-transparent rounded-r-lg">iOS App</a>

      <p class="text-xs font-semibold text-text-body-light uppercase tracking-wider px-3 mb-3 mt-6">Using Engramme</p>
      <a href="#conversations-web" class="nav-link block px-3 py-2 text-sm text-text-body-light border-l-2 border-transparent rounded-r-lg">Conversations (Web)</a>
      <a href="#conversations-ios" class="nav-link block px-3 py-2 text-sm text-text-body-light border-l-2 border-transparent rounded-r-lg">Conversations (iOS)</a>
      <a href="#web-browsing" class="nav-link block px-3 py-2 text-sm text-text-body-light border-l-2 border-transparent rounded-r-lg">Web Browsing</a>
      <a href="#gmail" class="nav-link block px-3 py-2 text-sm text-text-body-light border-l-2 border-transparent rounded-r-lg">Gmail</a>
      <a href="#ask-mode" class="nav-link block px-3 py-2 text-sm text-text-body-light border-l-2 border-transparent rounded-r-lg">Ask Mode</a>
      <a href="#memory-card" class="nav-link block px-3 py-2 text-sm text-text-body-light border-l-2 border-transparent rounded-r-lg">Memory Card Guide</a>

      <p class="text-xs font-semibold text-text-body-light uppercase tracking-wider px-3 mb-3 mt-6">Finish Up</p>
      <a href="#survey" class="nav-link block px-3 py-2 text-sm text-text-body-light border-l-2 border-transparent rounded-r-lg">Post Evaluation Survey</a>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content ml-64 pt-[57px]">

    <!-- Hero / Welcome -->
    <section id="welcome" class="px-6 sm:px-12 lg:px-20 py-16 lg:py-24 bg-bg-cream border-b border-border-light">
      <div class="max-w-3xl">
        <h1 class="text-4xl lg:text-5xl font-bold text-text-heading tracking-tight leading-tight mb-6">
          App Installation &<br>Usage Instructions
        </h1>
        <p class="text-lg text-text-body leading-relaxed mb-8">
          Thank you for helping us evaluate the Engramme Assistant. Your goal is to <strong>evaluate <span data-cfg="memoryCardGoal">500</span> memory cards in <span data-cfg="evaluationDays">7</span> days</strong>. You will receive <strong><span data-cfg="paymentAmount">$80</span></strong> after completion of the task. Partial task completion (anything short of the total) will lead to a compensation of <strong><span data-cfg="partialPayment">$5</span></strong>.
        </p>
        <div class="bg-white border border-border-light rounded-2xl p-6 space-y-3">
          <div class="flex items-center justify-between">
            <p class="text-sm font-semibold text-text-heading">Steps to complete:</p>
            <span class="text-xs font-medium text-text-body-light" id="main-progress-label">0/7</span>
          </div>
          <div class="progress-bar-container mb-1"><div class="progress-bar-fill" id="main-progress-bar"></div></div>
          <ol class="space-y-2 text-sm text-text-body" id="main-steps">
            <li class="flex gap-3 items-center" data-main-step="1"><input type="checkbox" class="main-step-cb" style="accent-color:#262626;width:18px;height:18px;cursor:pointer;flex-shrink:0;"><span class="flex-shrink-0 w-6 h-6 rounded-full bg-primary text-white text-xs flex items-center justify-center font-medium">1</span> <a href="consent.html" class="underline">Sign the consent form</a></li>
            <li class="flex gap-3 items-center" data-main-step="2"><input type="checkbox" class="main-step-cb" style="accent-color:#262626;width:18px;height:18px;cursor:pointer;flex-shrink:0;"><span class="flex-shrink-0 w-6 h-6 rounded-full bg-primary text-white text-xs flex items-center justify-center font-medium">2</span> <a href="https://docs.google.com/forms/d/1tVebw-wh1wN8V8jchy_Rmi8_jCYb_MxhWSeLBaHFxKY/edit" data-cfg-href="eligibilityFormUrl" target="_blank" class="underline">Complete the Engramme AmbI evaluation eligibility form</a></li>
            <li class="flex gap-3 items-center" data-main-step="3"><input type="checkbox" class="main-step-cb" style="accent-color:#262626;width:18px;height:18px;cursor:pointer;flex-shrink:0;"><span class="flex-shrink-0 w-6 h-6 rounded-full bg-primary text-white text-xs flex items-center justify-center font-medium">3</span> <a href="#signup" class="underline">Sign up and install integrations</a></li>
            <li class="flex gap-3 items-center" data-main-step="4"><input type="checkbox" class="main-step-cb" style="accent-color:#262626;width:18px;height:18px;cursor:pointer;flex-shrink:0;"><span class="flex-shrink-0 w-6 h-6 rounded-full bg-primary text-white text-xs flex items-center justify-center font-medium">4</span> <a href="#chrome" class="underline">Install the Chrome extension</a></li>
            <li class="flex gap-3 items-center" data-main-step="5"><input type="checkbox" class="main-step-cb" style="accent-color:#262626;width:18px;height:18px;cursor:pointer;flex-shrink:0;"><span class="flex-shrink-0 w-6 h-6 rounded-full bg-primary text-white text-xs flex items-center justify-center font-medium">5</span> <a href="#ios" class="underline">Install the iOS app</a></li>
            <li class="flex gap-3 items-center" data-main-step="6"><input type="checkbox" class="main-step-cb" style="accent-color:#262626;width:18px;height:18px;cursor:pointer;flex-shrink:0;"><span class="flex-shrink-0 w-6 h-6 rounded-full bg-primary text-white text-xs flex items-center justify-center font-medium">6</span> <a href="#conversations-web" class="underline">Perform your memory evaluations</a></li>
            <li class="flex gap-3 items-center" data-main-step="7"><input type="checkbox" class="main-step-cb" style="accent-color:#262626;width:18px;height:18px;cursor:pointer;flex-shrink:0;"><span class="flex-shrink-0 w-6 h-6 rounded-full bg-primary text-white text-xs flex items-center justify-center font-medium">7</span> <a href="#survey" class="underline">Complete the post evaluation survey</a></li>
          </ol>
        </div>
      </div>
    </section>

    <!-- Section 1: Sign Up & Integrate -->
    <section id="signup" class="px-6 sm:px-12 lg:px-20 py-16 border-b border-border-light">
      <div class="max-w-3xl">
        <p class="text-sm font-medium text-text-body-light uppercase tracking-wider mb-2">Getting Started</p>
        <h2 class="text-3xl font-bold text-text-heading tracking-tight mb-3">Sign Up & Integrate</h2>
        <p class="text-text-body leading-relaxed mb-10">In order for us to help you recall your memories, you need to create your account and connect relevant sources and applications.</p>

        <!-- Step 1.1 -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-1">Create your account</h3>
          <div class="space-y-5 mt-4">
            <div>
              <p class="text-sm text-text-body"><strong>1.1.</strong> Go to <a href="https://app.engramme.com/" data-cfg-href="appUrl" target="_blank" class="text-primary underline font-medium">app.engramme.com</a></p>
              <img src="images/image15.png" alt="Engramme login page" class="section-img mt-3 w-full max-w-md">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>1.2.</strong> Create an account by logging in with Google.</p>
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>1.3.</strong> Select your preferred Google account and sign in with your email and password.</p>
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>1.4.</strong> Press continue after you reach this screen.</p>
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>1.5.</strong> You should be redirected to the homepage that greets you with your name.</p>
              <img src="images/image98.png" alt="Engramme homepage" class="section-img mt-3 w-full max-w-md">
            </div>
          </div>
        </div>

        <!-- Step 2: Add Integrations -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-1">Add your integrations</h3>
          <div class="space-y-5 mt-4">
            <div>
              <p class="text-sm text-text-body"><strong>2.1.</strong> Click on the Plus sign to add integrations.</p>
              <img src="images/annotated-2-1-select-plus.png" alt="Click the plus sign" class="section-img mt-3 w-full max-w-md">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>2.2.</strong> Select the integrations you want to form part of your memories. More integrations lead to better memory quality.</p>
              <img src="images/image53.png" alt="Integration selection" class="section-img mt-3 w-full max-w-md">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>2.3.</strong> Choose your primary email address; this is the source from which your memories will be drawn.</p>
              <img src="images/image51.png" alt="Email selection" class="section-img mt-3 w-full max-w-md">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>2.4.</strong> Once you select an account, you will be shown a disclaimer. Click <strong>Advanced</strong> and then <strong>"Go to memorymachines-integrations..."</strong></p>
              <img src="images/annotated-2-4-advanced-link.png" alt="Advanced settings" class="section-img mt-3 w-full max-w-md">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>2.5.</strong> Click continue below and you should get a successful integration message at the top of your screen.</p>
              <img src="images/annotated-2-5-continue.png" alt="Successful integration" class="section-img mt-3 w-full max-w-md">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>2.6.</strong> Repeat this process for all the integrations that you would like to include. The more integrations, the better the quality of memories.</p>
            </div>
            <div class="bg-accent-gold/10 border border-accent-gold/30 rounded-xl p-4">
              <p class="text-sm text-text-body"><strong>Note:</strong> Integrations can take up to <strong><span data-cfg="integrationWaitTime">24 hours</span></strong> to fully ingest your data. You won't be able to see memories or provide feedback until your integrations have finished processing. Once they go through, memories will start appearing automatically. You can proceed with the installation steps below while you wait.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 2: Chrome Extension -->
    <section id="chrome" class="px-6 sm:px-12 lg:px-20 py-16 bg-bg-cream border-b border-border-light">
      <div class="max-w-3xl">
        <p class="text-sm font-medium text-text-body-light uppercase tracking-wider mb-2">Installation</p>
        <h2 class="text-3xl font-bold text-text-heading tracking-tight mb-3">Chrome Extension</h2>
        <p class="text-text-body leading-relaxed mb-10">Engramme Assistant is a Chrome/Gmail extension designed to help you organize and recall information directly from any website. Once installed and logged in, the extension automatically displays memory cards in a side panel while you surf the web.</p>

        <!-- Download -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">1. Download the Extension</h3>
          <div class="space-y-3">
            <p class="text-sm text-text-body"><strong>1.1.</strong> Download the extension files called <code class="bg-bg-subtle px-2 py-0.5 rounded text-sm" data-cfg="extensionZip">engramme_extension.zip</code> from <a href="download-extension.html" class="text-primary underline font-medium">this page</a>.</p>
            <p class="text-sm text-text-body"><strong>1.2.</strong> Unzip the file by double clicking; you should now see a folder titled <code class="bg-bg-subtle px-2 py-0.5 rounded text-sm" data-cfg="extensionFolder">engramme_extension</code>.</p>
            <div class="bg-accent-gold/10 border border-accent-gold/30 rounded-xl p-4 mt-3">
              <p class="text-sm text-text-body"><strong>To update:</strong> If you already downloaded the extension files, please <strong>DELETE THE EXISTING FOLDER</strong> in your local drive. Then, re-download the extension files from <a href="download-extension.html" class="text-primary underline font-medium">this page</a>.</p>
            </div>
          </div>
        </div>

        <!-- Open Extensions -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">2. Open Chrome Extensions</h3>
          <div class="space-y-3">
            <p class="text-sm text-text-body"><strong>2.1.</strong> Open your Google Chrome browser.</p>
            <p class="text-sm text-text-body"><strong>2.2.</strong> Type <code class="bg-bg-subtle px-2 py-0.5 rounded text-sm">chrome://extensions/</code> into the address bar and hit Enter.</p>
            <img src="images/image74.png" alt="Chrome extensions page" class="section-img mt-3 w-full max-w-lg">
          </div>
        </div>

        <!-- Developer Mode -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">3. Enable Developer Mode</h3>
          <p class="text-sm text-text-body"><strong>3.1.</strong> Look for the <strong>Developer mode</strong> switch, which is usually in the upper right corner, and click it to turn it ON.</p>
          <img src="images/annotated-3-1-developer-mode.png" alt="Enable developer mode" class="section-img mt-3 w-full max-w-lg">
        </div>

        <!-- Load Extension -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">4. Load the Extension</h3>
          <div class="space-y-4">
            <div>
              <p class="text-sm text-text-body"><strong>4.1.</strong> Click on the <strong>Load unpacked</strong> button, which is in the upper left corner.</p>
              <img src="images/annotated-4-1-load-unpacked.png" alt="Load unpacked button" class="section-img mt-3 w-full max-w-lg">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>4.2.</strong> A file selection window will appear. Navigate to and select the folder named <code class="bg-bg-subtle px-2 py-0.5 rounded text-sm" data-cfg="extensionFolder">engramme_extension</code> that you downloaded.</p>
              <img src="images/image31.png" alt="Select folder" class="section-img mt-3 w-full max-w-md">
            </div>
            <p class="text-sm text-text-body"><strong>4.3.</strong> If you installed a previous version, select the new version when you click <strong>Load Unpacked</strong>.</p>
            <div>
              <p class="text-sm text-text-body"><strong>4.4.</strong> You can find the extension successfully uploaded here.</p>
              <img src="images/annotated-4-4-extension-uploaded.png" alt="Extension uploaded" class="section-img mt-3 w-full max-w-lg">
            </div>
          </div>
        </div>

        <!-- Log In -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">5. Log in with your account</h3>
          <div class="space-y-4">
            <div>
              <p class="text-sm text-text-body"><strong>5.1.</strong> Once you've unpacked the extension, click on the <strong>puzzle piece</strong> in the top right, then select <strong>Engramme Assistant</strong>.</p>
              <img src="images/annotated-5-1-puzzle-piece.png" alt="Select extension" class="section-img mt-3 w-full max-w-xs">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>5.2.</strong> Click <strong>Sign in with Google</strong> and log in with the same account that you signed up with.</p>
              <img src="images/annotated-5-2-sign-in-google.png" alt="Sign in with Google" class="section-img mt-3 w-full max-w-xs">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>5.3.</strong> Once all your integrations go through (which can take up to <span data-cfg="integrationWaitTime">24 hours</span>), you will be able to view all your memories.</p>
              <img src="images/image10.png" alt="Memories view" class="section-img mt-3 w-full max-w-md">
            </div>
          </div>
        </div>

        <!-- Troubleshooting -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">6. Troubleshooting</h3>
          <div class="space-y-4">
            <div class="bg-bg-subtle rounded-xl p-4">
              <p class="text-sm text-text-body"><strong>Unable to log in with Google:</strong> Go to <code class="bg-white px-2 py-0.5 rounded text-sm">chrome://extensions</code> and ensure that the ID matches the ID field in the screenshot below exactly. If it doesn't, ensure that the version is at least <span data-cfg="extensionMinVersion">4.1.0</span>.</p>
              <img src="images/annotated-troubleshoot-login.png" alt="Extension ID" class="section-img mt-3 w-full max-w-md">
            </div>
            <div class="bg-bg-subtle rounded-xl p-4">
              <p class="text-sm text-text-body"><strong>Repeated errors when logging in:</strong> After loading the chrome extension, every single tab that uses it needs to be refreshed as the extension's functionality won't be reflected until the tab is refreshed.</p>
            </div>
            <div class="bg-bg-subtle rounded-xl p-4">
              <p class="text-sm text-text-body"><strong>Google sign in blocking you:</strong> Try using another account for signing in or just contact <a href="mailto:guha@engramme.com" data-cfg-mailto="contactEmail" class="underline font-medium">guha@engramme.com</a>.</p>
            </div>
            <div class="bg-bg-subtle rounded-xl p-4">
              <p class="text-sm text-text-body"><strong>If everything fails:</strong> Contact <a href="mailto:guha@engramme.com" data-cfg-mailto="contactEmail" class="underline font-medium">guha@engramme.com</a>.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 3: iOS App -->
    <section id="ios" class="px-6 sm:px-12 lg:px-20 py-16 border-b border-border-light">
      <div class="max-w-3xl">
        <p class="text-sm font-medium text-text-body-light uppercase tracking-wider mb-2">Installation</p>
        <h2 class="text-3xl font-bold text-text-heading tracking-tight mb-3">iOS App</h2>
        <p class="text-text-body leading-relaxed mb-10">The Engramme iOS app is an iPhone app designed to help you retrieve memories during conversations.</p>

        <!-- TestFlight -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">1. Download via TestFlight</h3>
          <div class="space-y-3">
            <p class="text-sm text-text-body"><strong>1.1.</strong> If you provided your iCloud email in the eligibility form, you will receive an invite from Apple to join our testing team. Check your junk folder if you don't see it in your main inbox.</p>
            <div class="bg-bg-subtle rounded-xl p-4">
              <p class="text-sm text-text-body">Not sure what your iCloud email is? <a href="icloud-find.html" class="text-primary underline font-medium">Here's how to find it.</a></p>
            </div>
            <p class="text-sm text-text-body"><strong>1.2.</strong> Accept the invite to join our testing organization. Once you've accepted, we'll send you a second invite to download the Engramme app via TestFlight.</p>
            <p class="text-sm text-text-body"><strong>1.3.</strong> Download <a href="https://apps.apple.com/us/app/testflight/id899247664" target="_blank" class="text-primary underline font-medium">TestFlight</a> from the App Store and log in with the same iCloud email you provided.</p>
            <p class="text-sm text-text-body"><strong>1.4.</strong> Open the TestFlight invitation and install the Engramme app from there.</p>
          </div>
        </div>

        <!-- Log in -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">2. Log in with Google</h3>
          <div class="space-y-4">
            <div>
              <p class="text-sm text-text-body"><strong>2.1.</strong> Sign in with the same Google account you created an account with in app.engramme.com.</p>
              <img src="images/image54.png" alt="iOS login" class="phone-img mt-3">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>2.2.</strong> Click on the plus and ensure all your integrations carried over. Connected integrations should have a green box around them and say <strong>Connected</strong> underneath.</p>
              <div class="flex gap-4 mt-3">
                <img src="images/image72.png" alt="Integrations" class="phone-img w-full max-w-[200px]">
                <img src="images/image87.png" alt="Connected integrations" class="phone-img w-full max-w-[200px]">
              </div>
            </div>
          </div>
        </div>

        <!-- Troubleshooting -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">3. Troubleshooting</h3>
          <div class="space-y-4">
            <div class="bg-bg-subtle rounded-xl p-4">
              <p class="text-sm text-text-body"><strong>Taking too long to get invited:</strong> Feel free to contact <a href="mailto:guha@engramme.com" data-cfg-mailto="contactEmail" class="underline font-medium">guha@engramme.com</a> to get this done.</p>
            </div>
            <div class="bg-bg-subtle rounded-xl p-4">
              <p class="text-sm text-text-body"><strong>Didn't get an email:</strong> Check your spam and ensure you're on the same iCloud account that you emailed <a href="mailto:guha@engramme.com" data-cfg-mailto="contactEmail" class="underline font-medium">guha@engramme.com</a> with.</p>
            </div>
            <div class="bg-bg-subtle rounded-xl p-4">
              <p class="text-sm text-text-body"><strong>Can't find an iCloud account:</strong> You may need to create one at <a href="https://www.icloud.com/" data-cfg-href="icloudUrl" target="_blank" class="underline">icloud.com</a>.</p>
            </div>
            <div class="bg-bg-subtle rounded-xl p-4">
              <p class="text-sm text-text-body"><strong>If everything fails:</strong> Contact <a href="mailto:guha@engramme.com" data-cfg-mailto="contactEmail" class="underline font-medium">guha@engramme.com</a>.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 4: Using and Evaluating Memories -->
    <section id="using" class="px-6 sm:px-12 lg:px-20 py-16 bg-bg-cream border-b border-border-light">
      <div class="max-w-3xl">
        <h2 class="text-3xl font-bold text-text-heading tracking-tight mb-3">Using & Evaluating Memories</h2>
        <p class="text-text-body leading-relaxed mb-4">There are multiple ways you can use the Engramme Assistant:</p>
        <div class="flex flex-wrap gap-2 mb-10">
          <a href="#conversations-web" class="bg-white border border-border-light rounded-xl px-4 py-2 text-sm font-medium text-text-body hover:border-primary transition-colors">Conversations (Web)</a>
          <a href="#conversations-ios" class="bg-white border border-border-light rounded-xl px-4 py-2 text-sm font-medium text-text-body hover:border-primary transition-colors">Conversations (iOS)</a>
          <a href="#web-browsing" class="bg-white border border-border-light rounded-xl px-4 py-2 text-sm font-medium text-text-body hover:border-primary transition-colors">Web Browsing</a>
          <a href="#gmail" class="bg-white border border-border-light rounded-xl px-4 py-2 text-sm font-medium text-text-body hover:border-primary transition-colors">Gmail</a>
          <a href="#ask-mode" class="bg-white border border-border-light rounded-xl px-4 py-2 text-sm font-medium text-text-body hover:border-primary transition-colors">Ask Mode</a>
        </div>
      </div>
    </section>

    <!-- Conversations - Web -->
    <section id="conversations-web" class="px-6 sm:px-12 lg:px-20 py-16 border-b border-border-light">
      <div class="max-w-3xl">
        <p class="text-sm font-medium text-text-body-light uppercase tracking-wider mb-2">Using Engramme</p>
        <h2 class="text-3xl font-bold text-text-heading tracking-tight mb-3">Real-world Conversations (Web App)</h2>
        <p class="text-text-body leading-relaxed mb-4">During a conversation with friends, family or colleagues, you can use the Engramme Assistant to provide you with memories in real time.</p>
        <div class="bg-accent-gold/10 border border-accent-gold/30 rounded-xl p-4 mb-10">
          <p class="text-sm text-text-body"><strong>Important:</strong> Before starting to use the app during conversation, be sure to seek consent from all parties.</p>
        </div>
        <p class="text-text-body leading-relaxed mb-10">As you talk, memories will surface automatically every <span data-cfg="memoryInterval">~30 seconds</span>. These memories are related to what the conversation is about.</p>

        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">How to Start Recording</h3>
          <div class="space-y-5">
            <div>
              <p class="text-sm text-text-body">When you open <a href="https://app.engramme.com" data-cfg-href="appUrl" target="_blank" class="underline font-medium">app.engramme.com</a>, you'll be greeted with the following screen.</p>
              <img src="images/image62.png" alt="Homepage" class="section-img mt-3 w-full max-w-lg">
            </div>
            <div>
              <p class="text-sm text-text-body">To begin recording, click on the <strong>Recording</strong> button.</p>
              <img src="images/image42.png" alt="Recording button" class="section-img mt-3 w-full max-w-xs">
            </div>
            <div>
              <p class="text-sm text-text-body">It will request you to allow access to your microphone. Select <strong>Allow while visiting this site</strong>.</p>
              <img src="images/image90.png" alt="Microphone permission" class="section-img mt-3 w-full max-w-md">
            </div>
            <div>
              <p class="text-sm text-text-body">The Recording button should turn <strong class="text-red-500">pink</strong> to indicate that it is recording.</p>
              <img src="images/image44.png" alt="Recording active" class="section-img mt-3 w-full max-w-xs">
            </div>
            <p class="text-sm text-text-body">As you speak, memory cards will appear. It may take about 20-30 seconds for memories to show up.</p>
          </div>
        </div>

        <!-- Memory Card Anatomy -->
        <div id="memory-card" class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">What's inside a Memory Card?</h3>
          <img src="images/annotated-memory-card-web.png" alt="Memory card anatomy" class="section-img mb-6 w-full max-w-lg">
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-bg-subtle">
                  <th class="text-left p-3 rounded-tl-lg font-semibold text-text-heading">#</th>
                  <th class="text-left p-3 rounded-tr-lg font-semibold text-text-heading">Description</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-border-light">
                <tr><td class="p-3 font-medium">1</td><td class="p-3"><strong>Thumbs up</strong> — The memory was relevant and accurate.</td></tr>
                <tr><td class="p-3 font-medium">2</td><td class="p-3"><strong>Thumbs down</strong> — The memory was irrelevant or inaccurate.</td></tr>
                <tr><td class="p-3 font-medium">3</td><td class="p-3"><strong>Comment</strong> — Type what you liked or disliked in more detail, then click save.</td></tr>
                <tr><td class="p-3 font-medium">4</td><td class="p-3"><strong>Copy</strong> — Copy the memory to your clipboard.</td></tr>
                <tr><td class="p-3 font-medium">5</td><td class="p-3"><strong>Participants</strong> — People or organizations involved in this memory.</td></tr>
                <tr><td class="p-3 font-medium">6</td><td class="p-3"><strong>Date of the memory</strong> — When the memory took place.</td></tr>
                <tr><td class="p-3 font-medium">7</td><td class="p-3"><strong>Source of the memory</strong> — Where the information was taken from.</td></tr>
              </tbody>
            </table>
          </div>
          <div class="bg-bg-subtle rounded-xl p-4 mt-4">
            <p class="text-sm text-text-body-light"><em>An unsaved comment will be submitted when you click any of the thumb buttons, but feel free to click the comment button again to edit and resubmit.</em></p>
          </div>
        </div>

        <!-- History Tab -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">History Tab</h3>
          <p class="text-sm text-text-body mb-4">We recognize that being engaged in a conversation and providing accurate feedback is difficult. For that reason, we have the History tab.</p>
          <div class="space-y-4">
            <div>
              <p class="text-sm text-text-body">Click on the <strong>History</strong> tab in the Navigation Bar at the top and you will then see memories from this session.</p>
              <img src="images/image47.png" alt="History tab" class="section-img mt-3 w-full max-w-lg">
            </div>
            <div>
              <p class="text-sm text-text-body">Feedback for any given memory must be tied to context. You can see the query that triggered each memory below the card <em>("I'm recalling memories with this query")</em>. Compare the query to your memory and check relevance and accuracy.</p>
              <img src="images/image55.png" alt="Memory context" class="section-img mt-3 w-full max-w-lg">
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Conversations - iOS -->
    <section id="conversations-ios" class="px-6 sm:px-12 lg:px-20 py-16 bg-bg-cream border-b border-border-light">
      <div class="max-w-3xl">
        <p class="text-sm font-medium text-text-body-light uppercase tracking-wider mb-2">Using Engramme</p>
        <h2 class="text-3xl font-bold text-text-heading tracking-tight mb-3">Real-world Conversations (iPhone)</h2>
        <p class="text-text-body leading-relaxed mb-4">During a conversation with friends, family or colleagues, you can use the iOS app to provide you with memories in real time.</p>
        <div class="bg-accent-gold/10 border border-accent-gold/30 rounded-xl p-4 mb-10">
          <p class="text-sm text-text-body"><strong>Important:</strong> Before starting to use the app during conversation, be sure to seek consent from all parties.</p>
        </div>

        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <div class="space-y-5">
            <div>
              <p class="text-sm text-text-body">When you open the app, you'll be greeted with the following screen:</p>
              <img src="images/image6.png" alt="iOS app home" class="phone-img mt-3">
            </div>
            <div>
              <p class="text-sm text-text-body">To begin recording your conversation and see memories surface, click on the <strong>microphone</strong> in the bottom-left. This will start recording and surface memories every <span data-cfg="memoryInterval">~30 seconds</span> (you can change this interval in settings).</p>
              <img src="images/image2.png" alt="iOS microphone" class="phone-img mt-3">
            </div>
            <div class="bg-bg-subtle rounded-xl p-4">
              <p class="text-sm text-text-body"><strong>Troubleshooting:</strong> If you're running into problems, go to <strong>Settings > Engramme > Microphone</strong> — access must be <strong>ON</strong>.</p>
            </div>
          </div>
        </div>

        <!-- Memory Card Anatomy (iOS) -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">The Memory Card</h3>
          <img src="images/annotated-memory-card-ios.png" alt="Memory card anatomy" class="section-img mb-6 w-full max-w-lg">
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-bg-subtle">
                  <th class="text-left p-3 rounded-tl-lg font-semibold text-text-heading">#</th>
                  <th class="text-left p-3 rounded-tr-lg font-semibold text-text-heading">Description</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-border-light">
                <tr><td class="p-3 font-medium">1</td><td class="p-3"><strong>Thumbs up</strong> — The memory was relevant and accurate.</td></tr>
                <tr><td class="p-3 font-medium">2</td><td class="p-3"><strong>Thumbs down</strong> — The memory was irrelevant or inaccurate.</td></tr>
                <tr><td class="p-3 font-medium">3</td><td class="p-3"><strong>Comment</strong> — Type what you liked or disliked in more detail, then click save.</td></tr>
                <tr><td class="p-3 font-medium">4</td><td class="p-3"><strong>Copy</strong> — Copy the memory to your clipboard.</td></tr>
                <tr><td class="p-3 font-medium">5</td><td class="p-3"><strong>Participants</strong> — People or organizations involved in this memory.</td></tr>
                <tr><td class="p-3 font-medium">6</td><td class="p-3"><strong>Date of the memory</strong> — When the memory took place.</td></tr>
                <tr><td class="p-3 font-medium">7</td><td class="p-3"><strong>Source of the memory</strong> — Where the information was taken from.</td></tr>
              </tbody>
            </table>
          </div>
          <div class="bg-bg-subtle rounded-xl p-4 mt-4">
            <p class="text-sm text-text-body-light"><em>An unsaved comment will be submitted when you click any of the thumb buttons, but feel free to click the comment button again to edit and resubmit.</em></p>
          </div>
        </div>

        <!-- History Tab (iOS) -->
        <div class="step-card bg-white border border-border-light rounded-2xl p-6">
          <h3 class="text-lg font-semibold text-text-heading mb-4">History Tab</h3>
          <p class="text-sm text-text-body mb-4">We recognize that being engaged in a conversation and providing accurate feedback is difficult. For that reason, we have the History tab.</p>
          <p class="text-sm text-text-body">Click on the <strong>History</strong> tab in the Navigation Bar at the top and you will see memories from this session. Click on a memory to see the dialogue that triggered it. Compare the query to your memory and check relevance and accuracy.</p>
        </div>
      </div>
    </section>

    <!-- Web Browsing -->
    <section id="web-browsing" class="px-6 sm:px-12 lg:px-20 py-16 border-b border-border-light">
      <div class="max-w-3xl">
        <p class="text-sm font-medium text-text-body-light uppercase tracking-wider mb-2">Using Engramme</p>
        <h2 class="text-3xl font-bold text-text-heading tracking-tight mb-3">Web Browsing</h2>

        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <div class="space-y-5">
            <div>
              <p class="text-sm text-text-body">On your Chrome browser, open any website. On the right side, you should see the Engramme Assistant bar with a memory card showing (it may take a few seconds).</p>
              <img src="images/image16.jpg" alt="Web browsing memories" class="section-img mt-3 w-full max-w-lg">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>Evaluate the memory card:</strong> Carefully read the descriptive text associated with each memory card to fully understand the context.</p>
              <ul class="list-disc list-inside text-sm text-text-body mt-2 space-y-1 ml-2">
                <li>To indicate <strong>acceptance</strong> (correct and relevant), select the <strong>thumbs up</strong> icon.</li>
                <li>To indicate <strong>rejection</strong> (incorrect, irrelevant, or both), select the <strong>thumbs down</strong> icon.</li>
                <li>Use the <strong>comments bubble</strong> to add more details.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Gmail -->
    <section id="gmail" class="px-6 sm:px-12 lg:px-20 py-16 bg-bg-cream border-b border-border-light">
      <div class="max-w-3xl">
        <p class="text-sm font-medium text-text-body-light uppercase tracking-wider mb-2">Using Engramme</p>
        <h2 class="text-3xl font-bold text-text-heading tracking-tight mb-3">Gmail</h2>

        <div class="step-card bg-white border border-border-light rounded-2xl p-6 mb-6">
          <div class="space-y-5">
            <div>
              <p class="text-sm text-text-body">On your Chrome browser, open Gmail. On the right side, you should see the Engramme Assistant bar.</p>
              <img src="images/image52.png" alt="Gmail integration" class="section-img mt-3 w-full max-w-lg">
            </div>
            <div>
              <p class="text-sm text-text-body">Open any email thread in your inbox. The Engramme Assistant will show relevant memories.</p>
              <img src="images/image13.png" alt="Gmail memories" class="section-img mt-3 w-full max-w-lg">
            </div>
            <div>
              <p class="text-sm text-text-body"><strong>Evaluate the memory card:</strong> Carefully read the content and assess quality and relevance.</p>
              <ul class="list-disc list-inside text-sm text-text-body mt-2 space-y-1 ml-2">
                <li>To indicate <strong>acceptance</strong> (correct and relevant), select the <strong>thumbs up</strong> icon.</li>
                <li>To indicate <strong>rejection</strong> (incorrect, irrelevant, or both), select the <strong>thumbs down</strong> icon.</li>
                <li>Use the <strong>comments bubble</strong> to add more details.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Ask Mode -->
    <section id="ask-mode" class="px-6 sm:px-12 lg:px-20 py-16 border-b border-border-light">
      <div class="max-w-3xl">
        <p class="text-sm font-medium text-text-body-light uppercase tracking-wider mb-2">Using Engramme</p>
        <h2 class="text-3xl font-bold text-text-heading tracking-tight mb-3">Ask Mode</h2>
        <p class="text-text-body leading-relaxed mb-10">Across the Chrome extension, iOS, and web app, you have the option to switch from memory card retrieval to asking questions.</p>

        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2">
          <div class="step-card bg-white border border-border-light rounded-2xl p-6">
            <h3 class="text-base font-semibold text-text-heading mb-3">In the Web App</h3>
            <p class="text-sm text-text-body mb-3">Click on the <strong>Ask</strong> button in the top right. This switches your input from fetching memories to a prompt.</p>
            <img src="images/image11.png" alt="Web app ask mode" class="section-img w-full">
          </div>

          <div class="step-card bg-white border border-border-light rounded-2xl p-6">
            <h3 class="text-base font-semibold text-text-heading mb-3">In the iOS App</h3>
            <p class="text-sm text-text-body mb-3">Click on the settings button in the top right and ensure <strong>"Ask"</strong> is selected under "Default Input Mode". Then type your questions.</p>
            <img src="images/image56.png" alt="iOS ask mode" class="phone-img mx-auto">
          </div>

          <div class="step-card bg-white border border-border-light rounded-2xl p-6 md:col-span-2 lg:col-span-1 xl:col-span-2">
            <h3 class="text-base font-semibold text-text-heading mb-3">In the Chrome Extension</h3>
            <p class="text-sm text-text-body mb-3">Click on the <strong>chat button</strong> in the bottom right of the extension overlay.</p>
            <img src="images/image12.png" alt="Extension ask mode" class="section-img w-full max-w-md">
          </div>
        </div>
      </div>
    </section>

    <!-- Post Evaluation Survey -->
    <section id="survey" class="px-6 sm:px-12 lg:px-20 py-16">
      <div class="max-w-3xl">
        <p class="text-sm font-medium text-text-body-light uppercase tracking-wider mb-2">Finish Up</p>
        <h2 class="text-3xl font-bold text-text-heading tracking-tight mb-3">Post Evaluation Survey</h2>
        <p class="text-text-body leading-relaxed mb-8">After completing your evaluations, please fill out the post evaluation survey.</p>

        <a href="https://docs.google.com/forms/d/17BRPQ4gTJf6MrIAzy26Ija1zT8Tf2e_-SG1A9dwjMn4/edit" data-cfg-href="surveyUrl" target="_blank" class="inline-flex items-center gap-2 bg-primary text-white px-6 py-3 rounded-xl text-sm font-medium hover:opacity-90 transition-opacity mb-10">
          Open Survey
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
        </a>

        <div class="bg-bg-subtle rounded-2xl p-6">
          <p class="text-sm font-semibold text-text-heading mb-3">Survey questions include:</p>
          <ul class="space-y-2 text-sm text-text-body">
            <li class="flex gap-2"><span class="text-text-body-light">1.</span> What was your overall impression while using the Engramme Assistant?</li>
            <li class="flex gap-2"><span class="text-text-body-light">2.</span> What are the main things that you would like to see improvements on?</li>
            <li class="flex gap-2"><span class="text-text-body-light">3.</span> What were the main challenges?</li>
            <li class="flex gap-2"><span class="text-text-body-light">4.</span> Please comment on the installation experience.</li>
            <li class="flex gap-2"><span class="text-text-body-light">5.</span> Please comment on the overall design and user experience.</li>
            <li class="flex gap-2"><span class="text-text-body-light">6.</span> How would you imagine using the Engramme Assistant in your daily life?</li>
            <li class="flex gap-2"><span class="text-text-body-light">7.</span> What would be the main features that you would like to see added?</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="px-6 sm:px-12 lg:px-20 py-8 border-t border-border-light bg-bg-cream">
      <div class="max-w-3xl flex items-center justify-between">
        <p class="text-sm text-text-body-light">Engramme &mdash; <span data-cfg="tagline">Omniscient AI to augment human cognition</span></p>
        <p class="text-xs text-text-body-light">Version <span data-cfg="version">1/2/2026</span></p>
      </div>
    </footer>

  </main>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" onclick="this.classList.remove('active')">
    <img id="lightbox-img" src="" alt="">
  </div>

  <!-- Active nav highlighting + lightbox -->
  <script>
    // Image lightbox
    document.querySelectorAll('.section-img, .phone-img').forEach(img => {
      img.addEventListener('click', () => {
        document.getElementById('lightbox-img').src = img.src;
        document.getElementById('lightbox').classList.add('active');
      });
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') document.getElementById('lightbox').classList.remove('active');
    });
  </script>

  <script>
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-link');

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          navLinks.forEach(link => link.classList.remove('active', 'font-medium', 'text-text-heading'));
          const activeLink = document.querySelector(`.nav-link[href="#${entry.target.id}"]`);
          if (activeLink) {
            activeLink.classList.add('active', 'font-medium', 'text-text-heading');
          }
        }
      });
    }, { rootMargin: '-20% 0px -80% 0px' });

    sections.forEach(section => observer.observe(section));
  </script>

  <!-- Accordion + Todo Checkboxes -->
  <script>
  (function() {
    const STORAGE_KEY = 'engramme-todo-progress';
    let savedState = {};
    try { savedState = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } catch(e) {}

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(savedState));
      updateProgressBars();
    }

    // 1. Convert step-card h3 elements into accordion toggles
    document.querySelectorAll('.step-card > h3').forEach(h3 => {
      const card = h3.parentElement;
      const chevron = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      chevron.setAttribute('class', 'chevron');
      chevron.setAttribute('fill', 'none');
      chevron.setAttribute('stroke', 'currentColor');
      chevron.setAttribute('viewBox', '0 0 24 24');
      chevron.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>';

      h3.classList.add('accordion-toggle');
      h3.appendChild(chevron);

      // Wrap everything after h3 in accordion-body
      const body = document.createElement('div');
      body.className = 'accordion-body';
      const siblings = [];
      let el = h3.nextElementSibling;
      while (el) { siblings.push(el); el = el.nextElementSibling; }
      siblings.forEach(s => body.appendChild(s));
      card.appendChild(body);

      h3.addEventListener('click', () => {
        card.classList.toggle('collapsed');
      });
    });

    // 2. Inject checkboxes before numbered sub-steps (X.X. pattern)
    document.querySelectorAll('.step-card p').forEach(p => {
      const strong = p.querySelector('strong');
      if (!strong) return;
      const match = strong.textContent.match(/^(\d+\.\d+)\./);
      if (!match) return;

      const section = p.closest('section');
      const sectionId = section ? section.id : 'unknown';
      const stepId = sectionId + '-' + match[1];

      // Wrap existing content in a todo-step layout
      const wrapper = document.createElement('div');
      wrapper.className = 'todo-step' + (savedState[stepId] ? ' checked' : '');

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = !!savedState[stepId];
      checkbox.setAttribute('data-step', stepId);

      const content = document.createElement('div');
      content.className = 'todo-content';

      // Move the p and any following sibling images into content
      const parent = p.parentElement;
      if (!parent) return;

      // Find the img that follows this p (if in a wrapper div)
      const pParent = p.closest('.space-y-5, .space-y-4, .space-y-3') ? p.parentElement : null;
      if (pParent && pParent.tagName === 'DIV' && pParent.parentElement && pParent.parentElement.classList.contains('accordion-body') || pParent && pParent.closest('.accordion-body')) {
        // The step is inside a div wrapper — wrap that div
        const stepDiv = p.parentElement;
        if (stepDiv.tagName === 'DIV' && stepDiv.children.length <= 3 && stepDiv.querySelector('p') === p) {
          stepDiv.before(wrapper);
          content.appendChild(stepDiv);
          wrapper.prepend(checkbox);
          wrapper.appendChild(content);
        } else {
          // Just wrap the p itself
          p.before(wrapper);
          content.appendChild(p);
          wrapper.prepend(checkbox);
          wrapper.appendChild(content);
        }
      } else {
        p.before(wrapper);
        content.appendChild(p);
        wrapper.prepend(checkbox);
        wrapper.appendChild(content);
      }

      checkbox.addEventListener('change', function() {
        savedState[stepId] = this.checked;
        wrapper.classList.toggle('checked', this.checked);
        saveState();
      });
    });

    // 3. Add progress bars to each section
    function addProgressBars() {
      document.querySelectorAll('section[id]').forEach(section => {
        const checkboxes = section.querySelectorAll('.todo-step input[type="checkbox"]');
        if (checkboxes.length < 2) return;

        const existing = section.querySelector('.progress-wrapper');
        if (existing) existing.remove();

        const h2 = section.querySelector('h2');
        if (!h2) return;

        const wrapper = document.createElement('div');
        wrapper.className = 'progress-wrapper flex items-center gap-3 mb-8';
        wrapper.innerHTML = '<div class="progress-bar-container flex-1"><div class="progress-bar-fill" data-section="' + section.id + '"></div></div><span class="text-xs font-medium text-text-body-light" data-progress-label="' + section.id + '">0/' + checkboxes.length + '</span>';

        const desc = h2.nextElementSibling;
        if (desc && desc.tagName === 'P') {
          desc.after(wrapper);
        } else {
          h2.after(wrapper);
        }
      });
      updateProgressBars();
    }

    function updateProgressBars() {
      document.querySelectorAll('section[id]').forEach(section => {
        const checkboxes = section.querySelectorAll('.todo-step input[type="checkbox"]');
        if (checkboxes.length < 2) return;
        const checked = section.querySelectorAll('.todo-step input[type="checkbox"]:checked').length;
        const pct = Math.round((checked / checkboxes.length) * 100);
        const bar = document.querySelector('[data-section="' + section.id + '"]');
        const label = document.querySelector('[data-progress-label="' + section.id + '"]');
        if (bar) bar.style.width = pct + '%';
        if (label) label.textContent = checked + '/' + checkboxes.length;
      });
    }

    addProgressBars();

    // 4. Main steps (1-7) checkboxes with localStorage
    const MAIN_KEY = 'engramme-main-steps';
    let mainState = {};
    try { mainState = JSON.parse(localStorage.getItem(MAIN_KEY)) || {}; } catch(e) {}

    function updateMainProgress() {
      const cbs = document.querySelectorAll('.main-step-cb');
      const checked = document.querySelectorAll('.main-step-cb:checked').length;
      const bar = document.getElementById('main-progress-bar');
      const label = document.getElementById('main-progress-label');
      if (bar) bar.style.width = Math.round((checked / cbs.length) * 100) + '%';
      if (label) label.textContent = checked + '/' + cbs.length;
    }

    document.querySelectorAll('.main-step-cb').forEach(cb => {
      const li = cb.closest('li');
      const step = li ? li.getAttribute('data-main-step') : null;
      if (step && mainState[step]) {
        cb.checked = true;
        li.style.opacity = '0.5';
        li.style.textDecoration = 'line-through';
        li.style.textDecorationColor = '#b0adab';
      }
      cb.addEventListener('change', function() {
        mainState[step] = this.checked;
        localStorage.setItem(MAIN_KEY, JSON.stringify(mainState));
        if (li) {
          li.style.opacity = this.checked ? '0.5' : '1';
          li.style.textDecoration = this.checked ? 'line-through' : 'none';
          li.style.textDecorationColor = '#b0adab';
        }
        updateMainProgress();
      });
    });
    updateMainProgress();
  })();
  </script>

  <!-- Admin Panel -->
  <style>
    .admin-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:199; backdrop-filter:blur(2px); }
    .admin-overlay.open { display:block; }
    .admin-panel { position:fixed; top:0; right:0; bottom:0; width:420px; max-width:100vw; background:#fff; z-index:200; transform:translateX(100%); transition:transform 0.3s ease; display:flex; flex-direction:column; box-shadow:-8px 0 30px rgba(0,0,0,0.15); }
    .admin-panel.open { transform:translateX(0); }
    .admin-field label { display:block; font-size:11px; font-weight:600; color:#787270; text-transform:uppercase; letter-spacing:0.05em; margin-bottom:4px; }
    .admin-field input { width:100%; padding:8px 12px; border:1px solid #e9e8e7; border-radius:10px; font-size:14px; font-family:inherit; color:#2c2827; outline:none; transition:border-color 0.2s; }
    .admin-field input:focus { border-color:#262626; }
    .admin-section-title { font-size:13px; font-weight:700; color:#151211; margin-bottom:12px; padding-bottom:8px; border-bottom:1px solid #e9e8e7; }
    .admin-btn { padding:10px 16px; border-radius:10px; font-size:13px; font-weight:600; cursor:pointer; transition:all 0.2s; border:none; font-family:inherit; }
    .admin-btn-primary { background:#262626; color:#fff; }
    .admin-btn-primary:hover { opacity:0.85; }
    .admin-btn-secondary { background:#f4f3f3; color:#2c2827; border:1px solid #e9e8e7; }
    .admin-btn-secondary:hover { background:#e9e8e7; }
    .admin-toast { position:fixed; bottom:24px; right:24px; background:#262626; color:#fff; padding:12px 20px; border-radius:12px; font-size:13px; font-weight:500; z-index:300; opacity:0; transform:translateY(10px); transition:all 0.3s; pointer-events:none; }
    .admin-toast.show { opacity:1; transform:translateY(0); }
  </style>

  <div class="admin-overlay" id="admin-overlay" onclick="closeAdmin()"></div>
  <div class="admin-panel" id="admin-panel">
    <div style="background:#262626; color:#fff; padding:16px 24px; display:flex; align-items:center; justify-content:space-between; flex-shrink:0;">
      <div style="display:flex;align-items:center;gap:10px;">
        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><circle cx="12" cy="12" r="3"/></svg>
        <span style="font-size:16px;font-weight:700;">Admin Panel</span>
      </div>
      <button onclick="closeAdmin()" style="background:none;border:none;color:rgba(255,255,255,0.7);cursor:pointer;padding:4px;" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='rgba(255,255,255,0.7)'">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>

    <div style="flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:24px;" id="admin-fields"></div>

    <div style="border-top:1px solid #e9e8e7; padding:16px 24px; display:flex; flex-direction:column; gap:10px; flex-shrink:0;">
      <button class="admin-btn admin-btn-primary" style="width:100%;" onclick="pushToGitHub()">Push to GitHub &amp; Deploy</button>
      <div style="display:flex;gap:10px;">
        <button class="admin-btn admin-btn-secondary" style="flex:1;" onclick="downloadConfig()">Download</button>
        <button class="admin-btn admin-btn-secondary" style="flex:1;" onclick="copyConfig()">Copy JSON</button>
        <button class="admin-btn admin-btn-secondary" style="flex:1;" onclick="clearGitHubToken()">Reset Token</button>
      </div>
    </div>
  </div>
  <div class="admin-toast" id="admin-toast"></div>

  <script>
  (function() {
    const ADMIN_PASS = 'mm-admin-pass';
    const CONFIG_FIELDS = {
      'Evaluation': [
        { key: 'paymentAmount', label: 'Payment Amount', placeholder: '$50' },
        { key: 'memoryCardGoal', label: 'Memory Card Goal', placeholder: '500' },
        { key: 'evaluationDays', label: 'Evaluation Period (days)', placeholder: '7' },
        { key: 'partialPayment', label: 'Partial Completion Payment', placeholder: '$5' },
      ],
      'Contact': [
        { key: 'contactEmail', label: 'Contact Email', placeholder: 'guha@engramme.com' },
        { key: 'adminEmail', label: 'Admin Email', placeholder: 'admin@engramme.com' },
        { key: 'consentEmail', label: 'Consent Form Recipient', placeholder: 'guha@engramme.com' },
      ],
      'URLs': [
        { key: 'appUrl', label: 'App URL', placeholder: 'https://app.engramme.com' },
        { key: 'eligibilityFormUrl', label: 'Eligibility Form URL', placeholder: 'https://docs.google.com/...' },
        { key: 'driveFolderUrl', label: 'Google Drive Folder', placeholder: 'https://drive.google.com/...' },
        { key: 'surveyUrl', label: 'Survey URL', placeholder: 'https://docs.google.com/...' },
        { key: 'icloudUrl', label: 'iCloud URL', placeholder: 'https://www.icloud.com/' },
      ],
      'Extension': [
        { key: 'extensionZip', label: 'Extension Zip Filename', placeholder: 'engramme_extension.zip' },
        { key: 'extensionFolder', label: 'Extension Folder Name', placeholder: 'engramme_extension' },
        { key: 'extensionMinVersion', label: 'Min Extension Version', placeholder: '4.1.0' },
      ],
      'Timing': [
        { key: 'integrationWaitTime', label: 'Integration Wait Time', placeholder: '24 hours' },
        { key: 'memoryInterval', label: 'Memory Surfacing Interval', placeholder: '~30 seconds' },
      ],
      'Footer': [
        { key: 'tagline', label: 'Tagline', placeholder: 'Omniscient AI to augment human cognition' },
        { key: 'version', label: 'Version', placeholder: '1/2/2026' },
      ],
    };

    let currentConfig = {};
    let defaultConfig = {};
    let adminOpen = false;

    // Load config.json and apply
    fetch('config.json')
      .then(r => r.json())
      .then(cfg => {
        defaultConfig = { ...cfg };
        currentConfig = { ...cfg };
        applyConfig(currentConfig);
      })
      .catch(() => console.warn('No config.json found, using page defaults.'));

    function applyConfig(cfg) {
      // data-cfg="key" → textContent
      document.querySelectorAll('[data-cfg]').forEach(el => {
        const key = el.getAttribute('data-cfg');
        if (cfg[key] !== undefined) el.textContent = cfg[key];
      });
      // data-cfg-href="key" → href
      document.querySelectorAll('[data-cfg-href]').forEach(el => {
        const key = el.getAttribute('data-cfg-href');
        if (cfg[key] !== undefined) el.href = cfg[key];
      });
      // data-cfg-mailto="key" → mailto:value + textContent
      document.querySelectorAll('[data-cfg-mailto]').forEach(el => {
        const key = el.getAttribute('data-cfg-mailto');
        if (cfg[key] !== undefined) {
          el.href = 'mailto:' + cfg[key];
          el.textContent = cfg[key];
        }
      });
    }

    function buildAdminFields() {
      const container = document.getElementById('admin-fields');
      container.innerHTML = '';
      for (const [section, fields] of Object.entries(CONFIG_FIELDS)) {
        const sectionDiv = document.createElement('div');
        sectionDiv.innerHTML = '<div class="admin-section-title">' + section + '</div>';
        const fieldsDiv = document.createElement('div');
        fieldsDiv.style.cssText = 'display:flex;flex-direction:column;gap:14px;';
        for (const field of fields) {
          const fieldDiv = document.createElement('div');
          fieldDiv.className = 'admin-field';
          const label = document.createElement('label');
          label.textContent = field.label;
          label.setAttribute('for', 'admin-' + field.key);
          const input = document.createElement('input');
          input.type = 'text';
          input.id = 'admin-' + field.key;
          input.value = currentConfig[field.key] || '';
          input.placeholder = field.placeholder;
          input.addEventListener('input', function() {
            currentConfig[field.key] = this.value;
            applyConfig(currentConfig);
          });
          fieldDiv.appendChild(label);
          fieldDiv.appendChild(input);
          fieldsDiv.appendChild(fieldDiv);
        }
        sectionDiv.appendChild(fieldsDiv);
        container.appendChild(sectionDiv);
      }
    }

    function showToast(msg) {
      const toast = document.getElementById('admin-toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2500);
    }

    window.openAdmin = function() {
      buildAdminFields();
      document.getElementById('admin-panel').classList.add('open');
      document.getElementById('admin-overlay').classList.add('open');
      adminOpen = true;
    };

    window.closeAdmin = function() {
      document.getElementById('admin-panel').classList.remove('open');
      document.getElementById('admin-overlay').classList.remove('open');
      adminOpen = false;
    };

    window.downloadConfig = function() {
      const blob = new Blob([JSON.stringify(currentConfig, null, 2) + '\n'], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'config.json';
      a.click();
      URL.revokeObjectURL(url);
      showToast('config.json downloaded');
    };

    window.copyConfig = function() {
      navigator.clipboard.writeText(JSON.stringify(currentConfig, null, 2) + '\n')
        .then(() => showToast('JSON copied to clipboard'))
        .catch(() => showToast('Failed to copy'));
    };

    const GH_REPO = 'guha-mahesh/betaEvals';
    const GH_FILE = 'config.json';
    const GH_TOKEN_KEY = 'mm-admin-gh-token';

    function getGitHubToken() {
      let token = localStorage.getItem(GH_TOKEN_KEY);
      if (!token) {
        token = prompt('Enter a GitHub Personal Access Token (needs repo contents write access):');
        if (token) localStorage.setItem(GH_TOKEN_KEY, token.trim());
      }
      return token ? token.trim() : null;
    }

    window.clearGitHubToken = function() {
      localStorage.removeItem(GH_TOKEN_KEY);
      showToast('GitHub token cleared');
    };

    window.pushToGitHub = async function() {
      const token = getGitHubToken();
      if (!token) return;

      const btn = event.target;
      btn.textContent = 'Pushing...';
      btn.disabled = true;

      try {
        // Get current file SHA
        const getRes = await fetch('https://api.github.com/repos/' + GH_REPO + '/contents/' + GH_FILE, {
          headers: { 'Authorization': 'token ' + token }
        });
        if (!getRes.ok) throw new Error('Failed to fetch file info (check token permissions)');
        const fileData = await getRes.json();

        // Push updated config
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(currentConfig, null, 2) + '\n')));
        const putRes = await fetch('https://api.github.com/repos/' + GH_REPO + '/contents/' + GH_FILE, {
          method: 'PUT',
          headers: {
            'Authorization': 'token ' + token,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            message: 'Update config via admin panel',
            content: content,
            sha: fileData.sha,
          }),
        });

        if (!putRes.ok) {
          const err = await putRes.json();
          throw new Error(err.message || 'Push failed');
        }

        showToast('Pushed! Vercel will deploy shortly.');
      } catch (e) {
        showToast('Error: ' + e.message);
        if (e.message.includes('token')) localStorage.removeItem(GH_TOKEN_KEY);
      } finally {
        btn.textContent = 'Push to GitHub & Deploy';
        btn.disabled = false;
      }
    };

    // Keyboard shortcut: Cmd+Shift+/
    document.addEventListener('keydown', function(e) {
      if ((e.metaKey || e.ctrlKey) && e.shiftKey && (e.code === 'Slash' || e.key === '/' || e.key === '?')) {
        e.preventDefault();
        if (adminOpen) { closeAdmin(); return; }
        const pass = prompt('Enter admin password:');
        if (pass === ADMIN_PASS) {
          openAdmin();
        } else if (pass !== null) {
          showToast('Incorrect password');
        }
      }
    });
  })();
  </script>

</body>
</html>
